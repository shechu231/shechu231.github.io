
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vue - Hexo</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="视频地址
笔记地址
补充父子组件通讯原则为了提高组件的独立性与重用性，父组件会通过 props 向下传数据给子组件，当子组件有事情要告诉父组件时会通过 $emit 事件告诉父组件。如此确保每个组件都,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Hexo" type="application/atom+xml"> 
    
    
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="Vue - Hexo"/>
    <meta name="twitter:description" content="视频地址
笔记地址
补充父子组件通讯原则为了提高组件的独立性与重用性，父组件会通过 props 向下传数据给子组件，当子组件有事情要告诉父组件时会通过 $emit 事件告诉父组件。如此确保每个组件都,"/>
    
    
    
    
    <meta property="og:site_name" content="Hexo"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="Vue - Hexo"/>
    <meta property="og:description" content="视频地址
笔记地址
补充父子组件通讯原则为了提高组件的独立性与重用性，父组件会通过 props 向下传数据给子组件，当子组件有事情要告诉父组件时会通过 $emit 事件告诉父组件。如此确保每个组件都,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Hexo</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">Vue</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">Vue</h1>
        <div class="stuff">
            <span>三月 13, 2022</span>
            

        </div>
        <div class="content markdown">
            <p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1h7411N7bg?p=8">视频地址</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43742708/article/details/114667391">笔记地址</a></p>
<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><h4 id="父子组件通讯原则"><a href="#父子组件通讯原则" class="headerlink" title="父子组件通讯原则"></a>父子组件通讯原则</h4><p>为了提高组件的独立性与重用性，父组件会通过 <code>props</code> 向下传数据给子组件，当子组件有事情要告诉父组件时会通过 <code>$emit</code> 事件告诉父组件。如此确保每个组件都是独立在相对隔离的环境中运行，可以大幅提高组件的维护性。</p>
<p>在《Vue组件通讯》一文中有详细介绍过这部分。但这套通讯原则对于兄弟组件之间的数据通讯就有一定的诟病。当然，在Vue中有其他的方式来处理兄弟组件之间的数据通讯，比如Vuex这样的库。但在很多情况之下，咱们的应用程序不需要类似Vuex这样的库来处理组件之间的数据通讯，而可以考虑Vue中的 事件总线 ，即 **EventBus **。<br>接下来的内容，就是来一起学习Vue中的 <code>EventBus</code> 相关的知识点。</p>
<h2 id="如何使用EventBus"><a href="#如何使用EventBus" class="headerlink" title="如何使用EventBus"></a>如何使用EventBus</h2><p>在Vue的项目中怎么使用 <code>EventBus</code> 来实现组件之间的数据通讯呢？具体可以通过下面几个步骤来完成。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>首先你需要做的是创建事件总线并将其导出，以便其它模块可以使用或者<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%9B%91%E5%90%AC&spm=1001.2101.3001.7020">监听</a>它。我们可以通过两种方式来处理。先来看第一种，新创建一个 <code>.js</code> 文件，比如 <code>event-bus.js</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// event-bus.js</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">export const EventBus = new Vue()</span><br></pre></td></tr></table></figure>

<p>你需要做的只是引入 Vue 并导出它的一个实例（在这种情况下，我称它为 <code>EventBus</code> ）。实质上它是一个不具备 DOM 的组件，它具有的仅仅只是它实例方法而已，因此它非常的轻便。</p>
<p>另外一种方式，可以直接在项目中的 <code>main.js</code> 初始化 <code>EventBus</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// main.js</span><br><span class="line">Vue.prototype.$EventBus = new Vue()</span><br></pre></td></tr></table></figure>

<h3 id="发送事件"><a href="#发送事件" class="headerlink" title="发送事件"></a>发送事件</h3><p>假设你有两个子组件： <code>DecreaseCount</code> 和 <code>IncrementCount</code> ，分别在按钮中绑定了 <code>decrease()</code>和 <code>increment()</code> 方法。这两个方法做的事情很简单，就是数值递减（增） <code>1</code> ，以及角度值递减（增） <code>180</code> 。在这两个方法中，通过 <code>EventBus.$emit(channel: string, callback(payload1,…))</code> 监听 <code>decreased</code> （和 <code>incremented</code> ）频道。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- DecreaseCount.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;button @click=&quot;decrease()&quot;&gt;-&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt; import &#123; EventBus &#125; from &quot;../event-bus.js&quot;;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;DecreaseCount&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                num: 1,</span><br><span class="line">                deg:180</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            decrease() &#123;</span><br><span class="line">                EventBus.$emit(&quot;decreased&quot;, &#123;</span><br><span class="line">                    num:this.num,</span><br><span class="line">                    deg:this.deg</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;; </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- IncrementCount.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;button @click=&quot;increment()&quot;&gt;+&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt; import &#123; EventBus &#125; from &quot;../event-bus.js&quot;;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;IncrementCount&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                num: 1,</span><br><span class="line">                deg:180</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            increment() &#123;</span><br><span class="line">                EventBus.$emit(&quot;incremented&quot;, &#123;</span><br><span class="line">                    num:this.num,</span><br><span class="line">                    deg:this.deg</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"> &lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的示例，在 <code>DecreaseCount</code> 和 <code>IncrementCount</code> 分别发送出了 <code>decreased</code> 和 <code>incremented</code>频道。接下来，我们需要在另一个组件中接收这两个事件，保持数据在各组件之间的通讯。</p>
<h3 id="接收事件"><a href="#接收事件" class="headerlink" title="接收事件"></a>接收事件</h3><p>现在我们可以在组件 <code>App.vue</code> 中使用 <code>EventBus.$on(channel: string, callback(payload1,…))</code>监听 <code>DecreaseCount</code> 和 <code>IncrementCount</code> 分别发送出了 <code>decreased</code> 和 <code>incremented</code> 频道。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- App.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;container&quot; :style=&quot;&#123;transform: &#x27;rotateY(&#x27; + degValue + &#x27;deg)&#x27;&#125;&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;front&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;increment&quot;&gt;</span><br><span class="line">                    &lt;IncrementCount /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;show-front&quot;&gt; &#123;&#123;fontCount&#125;&#125; &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;decrement&quot;&gt;</span><br><span class="line">                    &lt;DecreaseCount /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=&quot;back&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;increment&quot;&gt;</span><br><span class="line">                    &lt;IncrementCount /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;show-back&quot;&gt; &#123;&#123;backCount&#125;&#125; &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;decrement&quot;&gt;</span><br><span class="line">                    &lt;DecreaseCount /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt; </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import IncrementCount from &quot;./components/IncrementCount&quot;;</span><br><span class="line">    import DecreaseCount from &quot;./components/DecreaseCount&quot;;</span><br><span class="line">    import &#123; EventBus &#125; from &quot;./event-bus.js&quot;;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;App&quot;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            IncrementCount,</span><br><span class="line">            DecreaseCount</span><br><span class="line">        &#125;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                degValue:0,</span><br><span class="line">                fontCount:0,</span><br><span class="line">                backCount:0</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        mounted() &#123;</span><br><span class="line">            EventBus.$on(&quot;incremented&quot;, (&#123;num,deg&#125;) =&gt; &#123;</span><br><span class="line">                this.fontCount += num</span><br><span class="line">                this.$nextTick(()=&gt;&#123;</span><br><span class="line">                    this.backCount += num</span><br><span class="line">                    this.degValue += deg;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">            EventBus.$on(&quot;decreased&quot;, (&#123;num,deg&#125;) =&gt; &#123;</span><br><span class="line">                this.fontCount -= num</span><br><span class="line">                this.$nextTick(()=&gt;&#123;</span><br><span class="line">                    this.backCount -= num</span><br><span class="line">                    this.degValue -= deg;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;; </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>最终得到的效果如下：</p>
<p>最后用一张图来描述示例中用到的 <code>EventBus</code> 之间的关系：</p>
<p><img src="https://s2.loli.net/2022/03/13/Z1uevNML397z5pT.png" alt="img"></p>
<p>如果你只想监听一次事件的发生，可以使用 <code>EventBus.$once(channel: string, callback(payload1,…))</code> 。</p>
<h3 id="移除事件监听者"><a href="#移除事件监听者" class="headerlink" title="移除事件监听者"></a>移除事件监听者</h3><p>如果想移除事件的监听，可以像下面这样操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; eventBus &#125; from &#x27;./event-bus.js&#x27;</span><br><span class="line">EventBus.$off(&#x27;decreased&#x27;, &#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>你也可以使用 <code>EventBus.$off(‘decreased’)</code> 来移除应用内所有对此事件的监听。或者直接调用<code>EventBus.$off()</code> 来移除所有事件频道， <strong>注意不需要添加任何参数</strong> 。</p>
<p>上面就是 <code>EventBus</code> 的使用方式，是不是很简单。上面的示例中我们也看到了，每次使用 <code>EventBus</code> 时都需要在各组件中引入 <code>event-bus.js</code> 。事实上，我们还可以通过别的方式，让事情变得简单一些。那就是创建一个全局的 <code>EventBus</code> 。接下来的示例向大家演示如何在Vue项目中创建一个全局的 <code>EventBus</code> 。</p>
<h2 id="全局EventBus"><a href="#全局EventBus" class="headerlink" title="全局EventBus"></a>全局EventBus</h2><p>全局EventBus，虽然在某些示例中不提倡使用，但它是一种非常漂亮且简单的方法，可以跨组件之间共享数据。</p>
<p>它的工作原理是发布/订阅方法，通常称为 <code>Pub/Sub</code> 。</p>
<p>这整个方法可以看作是一种设计模式，因为如果你查看它周围的东西，你会发现它更像是一种体系结构解决方案。我们将使用普通的JavaScript，并创建两个组件，并演示EventBus的工作方式。</p>
<p>让我们看看下图，并试着了解在这种情况下究竟发生了什么。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13341631-40d2629faddb7b76.png!web?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<p>我们从上图中可以得出以下几点：</p>
<ul>
<li>有一个全局EventBus</li>
<li>所有事件都订阅它</li>
<li>所有组件也发布到它，订阅组件获得更新</li>
<li>总结一下。所有组件都能够将事件发布到总线，然后总线由另一个组件订阅，然后订阅它的组件将得到更新</li>
</ul>
<p>在代码中，我们将保持它非常小巧和简洁。我们将它分为两部分，将展示两个组件以及生成事件总线的代码。</p>
<h3 id="创建全局EventBus"><a href="#创建全局EventBus" class="headerlink" title="创建全局EventBus"></a>创建全局EventBus</h3><p>全局事件总线只不过是一个简单的 <code>vue</code> 组件。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var EventBus = new Vue();</span><br><span class="line"></span><br><span class="line">Object.defineProperties(Vue.prototype, &#123;</span><br><span class="line">    $bus: &#123;</span><br><span class="line">        get: function () &#123;</span><br><span class="line">            return EventBus</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>现在，这个特定的总线使用两个方法 <code>$on</code> 和 <code>$emit</code> 。一个用于创建发出的事件，它就是<code>$emit</code> ；另一个用于订阅 <code>$on</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var EventBus = new Vue();</span><br><span class="line"></span><br><span class="line">this.$bus.$emit(&#x27;nameOfEvent&#x27;,&#123; ... pass some event data ...&#125;);</span><br><span class="line"></span><br><span class="line">this.$bus.$on(&#x27;nameOfEvent&#x27;,($event) =&gt; &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>现在，我们创建两个简单的组件，以便最终得出结论。</p>
<p>接下来的这个示例中，我们创建了一个 <code>ShowMessage</code> 的组件用来显示信息，另外创建一个 <code>UpdateMessage</code> 的组件，用来更新信息。</p>
<p>在 <code>UpdateMessage</code> 组件中触发需要的事件。在这个示例中，将触发一个 <code>updateMessage</code> 事件，这个事件发送了 <code>updateMessage</code> 的频道：</p>
<h3 id="创建全局EventBus-1"><a href="#创建全局EventBus-1" class="headerlink" title="创建全局EventBus"></a>创建全局EventBus</h3><p>全局事件总线只不过是一个简单的 <code>vue</code> 组件。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var EventBus = new Vue();</span><br><span class="line"></span><br><span class="line">Object.defineProperties(Vue.prototype, &#123;</span><br><span class="line">    $bus: &#123;</span><br><span class="line">        get: function () &#123;</span><br><span class="line">            return EventBus</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>现在，这个特定的总线使用两个方法 <code>$on</code> 和 <code>$emit</code> 。一个用于创建发出的事件，它就是<code>$emit</code> ；另一个用于订阅 <code>$on</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var EventBus = new Vue();</span><br><span class="line"></span><br><span class="line">this.$bus.$emit(&#x27;nameOfEvent&#x27;,&#123; ... pass some event data ...&#125;);</span><br><span class="line"></span><br><span class="line">this.$bus.$on(&#x27;nameOfEvent&#x27;,($event) =&gt; &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>现在，我们创建两个简单的组件，以便最终得出结论。</p>
<p>接下来的这个示例中，我们创建了一个 <code>ShowMessage</code> 的组件用来显示信息，另外创建一个 <code>UpdateMessage</code> 的组件，用来更新信息。</p>
<p>在 <code>UpdateMessage</code> 组件中触发需要的事件。在这个示例中，将触发一个 <code>updateMessage</code> 事件，这个事件发送了 <code>updateMessage</code> 的频道：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- UpdateMessage.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;form&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;form-control&quot;&gt;</span><br><span class="line">            &lt;input v-model=&quot;message&quot; &gt;</span><br><span class="line">            &lt;button @click=&quot;updateMessage()&quot;&gt;更新消息&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">        name: &quot;UpdateMessage&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                message: &quot;这是一条消息&quot;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            updateMessage() &#123;</span><br><span class="line">                this.$bus.$emit(&quot;updateMessage&quot;, this.message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        beforeDestroy () &#123;</span><br><span class="line">            $this.$bus.$off(&#x27;updateMessage&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"> &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>同时在 <code>ShowMessage</code> 组件中监听该事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ShowMessage.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;message&quot;&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt; </span><br><span class="line">export default &#123;</span><br><span class="line">        name: &quot;ShowMessage&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                message: &quot;我是一条消息&quot;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        created() &#123;</span><br><span class="line">            var self = this</span><br><span class="line">            this.$bus.$on(&#x27;updateMessage&#x27;, function(value) &#123;</span><br><span class="line">                self.updateMessage(value);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            updateMessage(value) &#123;</span><br><span class="line">                this.message = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;; </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>最终的效果如下：</p>
<p>从上面的代码中，我们可以看到 <code>ShowMessage</code> 组件侦听一个名为 <code>updateMessage</code> 的特定事件，这个事件在组件实例化时被触发，或者你可以在创建组件时触发。另一方面，我们有另一个组件<code>UpdateMessage</code> ，它有一个按钮，当有人点击它时会发出一个事件。这导致订阅组件侦听发出的事件。这产生了 <code>Pub/Sub</code> 模型，该模型在兄弟姐妹之间持续存在并且非常容易实现。</p>
<h1 id="组件之间共享数据的方式"><a href="#组件之间共享数据的方式" class="headerlink" title="组件之间共享数据的方式"></a>组件之间共享数据的方式</h1><p><img src="https://s2.loli.net/2022/03/13/xAVO39iYqyM6Svn.png" alt="image-20220313104108288"></p>
<h1 id="Vuex是什么"><a href="#Vuex是什么" class="headerlink" title="Vuex是什么"></a>Vuex是什么</h1><p>组件之间共享数据的方案</p>
<p><img src="https://s2.loli.net/2022/03/13/xGLhDvTZ9Kj5XPi.png" alt="image-20220313104454888"></p>
<p><img src="https://s2.loli.net/2022/03/13/bjF5QJDHVz1SwXE.png" alt="image-20220313104532719"></p>
<h4 id="引入组件"><a href="#引入组件" class="headerlink" title="引入组件"></a>引入组件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import navcon from &#x27;../components/navcon.vue&#x27;</span><br><span class="line">import leftnav from &#x27;../components/leftnav.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;index&#x27;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      showclass: &#x27;asideshow&#x27;,</span><br><span class="line">      showtype: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 注册组件</span><br><span class="line">  components: &#123;</span><br><span class="line">    &quot;my-navcon&quot;:navcon,</span><br><span class="line">    leftnav</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><h3 id="1-安装vuex依赖包"><a href="#1-安装vuex依赖包" class="headerlink" title="1.安装vuex依赖包"></a>1.安装vuex依赖包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex --save</span><br></pre></td></tr></table></figure>

<h3 id="2-导入vuex包"><a href="#2-导入vuex包" class="headerlink" title="2.导入vuex包"></a>2.导入vuex包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import Vuex from &#x27;vuex&#x27;</span><br><span class="line">Vue.use(Vuex)</span><br></pre></td></tr></table></figure>

<h3 id="3-创建store对象"><a href="#3-创建store对象" class="headerlink" title="3.创建store对象"></a>3.创建store对象</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const store = new Vuex.Store(&#123;</span><br><span class="line">//state存放全局共享的数据</span><br><span class="line">state:&#123;count:0&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-将store对象挂在到vue实例中"><a href="#4-将store对象挂在到vue实例中" class="headerlink" title="4.将store对象挂在到vue实例中"></a>4.将store对象挂在到vue实例中</h3><h5 id="main-js："><a href="#main-js：" class="headerlink" title="main.js："></a>main.js：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line">import store from &#x27;./store&#x27;</span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = false</span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">el:&#x27;#app&#x27;,</span><br><span class="line">render:h=&gt;h(app),</span><br><span class="line">//将创建的共享数据对象，挂载到Vue实例中</span><br><span class="line">//所有的组件，就可以直接从store中获取全局的数据了。	</span><br><span class="line">store</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="store-index-js"><a href="#store-index-js" class="headerlink" title="store / index.js"></a>store / index.js</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import Vuex from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">export default new Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="State-数据源"><a href="#State-数据源" class="headerlink" title="State 数据源"></a>State 数据源</h1><p>State提供唯一的公共数据源，所有共享的数据都要统一放到 Store的 State I中进行存储。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//创建store数据源，提供唯一公共数据</span><br><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import Vuex from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">export default new Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    count: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="通过-this-store-state-全局数据名称-访问"><a href="#通过-this-store-state-全局数据名称-访问" class="headerlink" title="通过 this.$store.state.全局数据名称 访问"></a>通过 this.$store.state.全局数据名称 访问</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$store.state.全局数据名称</span><br></pre></td></tr></table></figure>

<p>由于在模板字符串中，是不需要写this的，所以直接写this后边的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;当前最新的count值为：&#123;&#123;$store.state.count&#125;&#125;&lt;/h3&gt;</span><br></pre></td></tr></table></figure>

<h2 id="mapState-映射为计算属性"><a href="#mapState-映射为计算属性" class="headerlink" title="mapState 映射为计算属性"></a>mapState 映射为计算属性</h2><p>通过刚オ导入的 mapState 函数，将当前组件需要的全局数据，映射为当前组件的 computed计算属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用： --&gt;</span><br><span class="line">&lt;h3&gt;当前最新的count值为：&#123;&#123; Count &#125;&#125;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;当前最新的count值为：&#123;&#123; xCount &#125;&#125;&lt;/h3&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//1.导入辅助函数 mapState</span><br><span class="line">import &#123; mapState &#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">  	// mapState 可以接收数组或对象形式的参数 映射为计算属性，下面分别示例</span><br><span class="line">  	</span><br><span class="line">  	//2.1 传入数组 </span><br><span class="line">    ...mapState([&#x27;count&#x27;]),</span><br><span class="line">	</span><br><span class="line">	//2.2 对象形式 可以自定义名称</span><br><span class="line">	...mapState(&#123;</span><br><span class="line">		xCount:state =&gt; state.count</span><br><span class="line">	&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Mutations-变更store中的数据"><a href="#Mutations-变更store中的数据" class="headerlink" title="Mutations 变更store中的数据"></a>Mutations 变更store中的数据</h1><blockquote>
<p>Mutations用于变更 Store中的数据。</p>
</blockquote>
<p>注意： 只有 mutations里的函数，才有权利修改 state 的数据<br>注意： <strong>mutations里不能包含异步操作</strong>。</p>
<p>①只能通过 mutations变更 Store数据，不可以直接操作 Store中的数据。<br>②通过这种方式虽然操作起来稍微繁琐一些，但是可以集中监控所有数据的变化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const store = new Vuex.Store(&#123;</span><br><span class="line">  state:&#123;</span><br><span class="line">	count:0</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">	add(state)&#123;</span><br><span class="line">	  //变更状态</span><br><span class="line">	  state.count++</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="this-store-commit-触发-mutations"><a href="#this-store-commit-触发-mutations" class="headerlink" title="this.$store.commit() 触发 mutations"></a>this.$store.commit() 触发 mutations</h2><p><code>this.$store.commit()</code> 是触发 mutations的第一种方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">Increment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="触发-mutations-时传递值"><a href="#触发-mutations-时传递值" class="headerlink" title="触发 mutations 时传递值"></a>触发 mutations 时传递值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IncrementN()&#123;</span><br><span class="line">  this.$store.commit(&#x27;addN&#x27;,5)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mutations: &#123;</span><br><span class="line">  add(state) &#123;</span><br><span class="line">    // 变更状态</span><br><span class="line">    state.count++</span><br><span class="line">  &#125;,</span><br><span class="line">  addN(state,step)&#123;</span><br><span class="line">    // 变更状态</span><br><span class="line">    state.count += step</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="MapMutations-映射为方法"><a href="#MapMutations-映射为方法" class="headerlink" title="MapMutations 映射为方法"></a>MapMutations 映射为方法</h2><p>触发mutations的第二种方式：</p>
<p>1.从vuex中按需导入 mapMutations函数<br><code>import &#123;mapMutations&#125; from &#39;vuex&#39;</code></p>
<p>2.通过刚才按需导入的 mapMutations函数，映射为当前组件的<code>methods</code>函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// store</span><br><span class="line">mutations: &#123;</span><br><span class="line">  add(state) &#123;</span><br><span class="line">    // 变更状态</span><br><span class="line">    state.count++</span><br><span class="line">  &#125;,</span><br><span class="line">  sub(state) &#123;</span><br><span class="line">    state.count--</span><br><span class="line">  &#125;,</span><br><span class="line">  addN(state, step) &#123;</span><br><span class="line">    // 变更状态</span><br><span class="line">    state.count += step</span><br><span class="line">  &#125;,</span><br><span class="line">  subN(state, step) &#123;</span><br><span class="line">    state.count -= step</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">// 组件A</span><br><span class="line">import &#123; mapState,mapMutations &#125; from &#x27;vuex&#x27;</span><br><span class="line">methods:&#123;</span><br><span class="line">  ...mapMutations([&#x27;sub&#x27;,&#x27;subN&#x27;]),</span><br><span class="line">  decrement()&#123;</span><br><span class="line">    // 调用 </span><br><span class="line">    this.sub()</span><br><span class="line">  &#125;,</span><br><span class="line">  decrementN()&#123;</span><br><span class="line">    this.subN(5)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MapMutations-映射为方法-1"><a href="#MapMutations-映射为方法-1" class="headerlink" title="MapMutations 映射为方法"></a>MapMutations 映射为方法</h2><p>触发mutations的第二种方式：</p>
<p>1.从vuex中按需导入 mapMutations函数<br><code>import &#123;mapMutations&#125; from &#39;vuex&#39;</code></p>
<p>2.通过刚才按需导入的 mapMutations函数，映射为当前组件的<code>methods</code>函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// store</span><br><span class="line">mutations: &#123;</span><br><span class="line">  add(state) &#123;</span><br><span class="line">    // 变更状态</span><br><span class="line">    state.count++</span><br><span class="line">  &#125;,</span><br><span class="line">  sub(state) &#123;</span><br><span class="line">    state.count--</span><br><span class="line">  &#125;,</span><br><span class="line">  addN(state, step) &#123;</span><br><span class="line">    // 变更状态</span><br><span class="line">    state.count += step</span><br><span class="line">  &#125;,</span><br><span class="line">  subN(state, step) &#123;</span><br><span class="line">    state.count -= step</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">// 组件A</span><br><span class="line">import &#123; mapState,mapMutations &#125; from &#x27;vuex&#x27;</span><br><span class="line">methods:&#123;</span><br><span class="line">  ...mapMutations([&#x27;sub&#x27;,&#x27;subN&#x27;]),</span><br><span class="line">  decrement()&#123;</span><br><span class="line">    // 调用 </span><br><span class="line">    this.sub()</span><br><span class="line">  &#125;,</span><br><span class="line">  decrementN()&#123;</span><br><span class="line">    this.subN(5)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Actions-专门处理异步操作"><a href="#Actions-专门处理异步操作" class="headerlink" title="Actions 专门处理异步操作"></a>Actions 专门处理异步操作</h1><p>Actions用于处理异步任务。</p>
<p>如果通过<strong>异步</strong>操作变更数据，<strong>必须通过 Action</strong>,而不能使用Mutation,但是在 Action中还是要<strong>通过触发Mutation</strong>的方式间接<strong>变更数据</strong>。</p>
<p>注意： 在Actions 中不能直接修改 state中的数据，要通过 mutations修改。</p>
<h2 id="this-store-dispatch-触发-Actions"><a href="#this-store-dispatch-触发-Actions" class="headerlink" title="this.$store.dispatch 触发 Actions"></a>this.$store.dispatch 触发 Actions</h2><p>store.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 定义 Action</span><br><span class="line">const store = new Vuex.store(&#123;</span><br><span class="line">  // ...省略其他代码</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    // 只有 mutations中的函数才有权利修改 state。</span><br><span class="line">    // 不能在 mutations里执行异步操作。</span><br><span class="line">    add(state) &#123;</span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    // 在Actions 中不能直接修改 state中的数据，要通过 mutations修改。</span><br><span class="line">    addAsync(context) &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        context.commit(&#x27;add&#x27;)</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>组件A</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触发 Action</span></span><br><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line">  <span class="function"><span class="title">handle</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 触发 actions 的第一种方式</span></span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;addAsync&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mapActions-映射为方法"><a href="#mapActions-映射为方法" class="headerlink" title="mapActions 映射为方法"></a>mapActions 映射为方法</h2><p>1.从Vuex中按需导入 <code>mapActions</code> 函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapActions&#125; from &#x27;vuex&#x27;</span><br></pre></td></tr></table></figure>

<p>2.将指定的 actions 函数，映射为当前组件 methods 的方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods:&#123;</span><br><span class="line">  ...mapActions([<span class="string">&#x27;subAsync&#x27;</span>]),</span><br><span class="line">  <span class="function"><span class="title">decrementAsync</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.subAsync()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>store.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">actions: &#123;</span><br><span class="line"> // 在Actions 中不能直接修改 state中的数据，要通过 mutations修改。</span><br><span class="line">  subAsync(context)&#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      context.commit(&#x27;sub&#x27;)</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h1><p>Getter 用于对 Store中的数据进行加工处理形成新的数据。</p>
<p>Getter <strong>不会修改 Store 中的原数据</strong>，它只起到一个包装器的作用，将Store中的数据加工后输出出来。</p>
<ol>
<li>Getter可以对 Store中已有的数据加工处理之后形成新的数据，类似Vue的计算属性。</li>
<li>Store中数据发生变化， Getter 的数据也会跟着变化。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;&#123;&#123;$store.getters.showNum&#125;&#125;&gt;&gt;</span><br><span class="line">//定义 Getter</span><br><span class="line">const store = new Vuex.Store(&#123;</span><br><span class="line">  state:&#123;</span><br><span class="line">	count:0</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    showNum(state) &#123;</span><br><span class="line">      return &#x27;当前最新的数量是【&#x27; + state.count + &#x27;】&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="通过-this-store-getters-名称-访问"><a href="#通过-this-store-getters-名称-访问" class="headerlink" title="通过 this.$store.getters.名称 访问"></a>通过 this.$store.getters.名称 访问</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$store.getters.名称</span><br></pre></td></tr></table></figure>

<h2 id="mapGetters-映射为计算属性"><a href="#mapGetters-映射为计算属性" class="headerlink" title="mapGetters 映射为计算属性"></a>mapGetters 映射为计算属性</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">computed</span>:&#123;</span><br><span class="line">	...mapGetters([<span class="string">&#x27;showNum&#x27;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="简写"><a href="#简写" class="headerlink" title="简写"></a>简写</h1><p>其实，通过<code>mapState,mapMutations,mapActions,mapGetters</code>映射过来的计算属性，或者方法都可以直接调用，不用在 <code>commit</code> 或者 <code>dispatch</code></p>
<p>如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=&quot;decrementAsync&quot;&gt;-1Async&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapActions&#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">//...省略一些代码</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">  ...mapActions([&#x27;subAsync&#x27;]),</span><br><span class="line">  decrementAsync()&#123;</span><br><span class="line">    this.subAsync()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>其实可以简写成：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;subAsync&quot;</span>&gt;</span>-1Async<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapActions&#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">//...省略一些代码</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">  ...mapActions([&#x27;subAsync&#x27;]),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>有参数的时候，也可以直接把参数带上，就像这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;subAsync(5)&quot;</span>&gt;</span>+5<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapActions&#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">//...省略一些代码</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">  ...mapActions([&#x27;addAsync&#x27;]),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="Vuex-todoList-案例"><a href="#Vuex-todoList-案例" class="headerlink" title="Vuex todoList 案例"></a>Vuex todoList 案例</h1><p>由于代码较多就不放在 CSDN了。</p>
<p>我打包上传到了 蓝奏云，需要的去下载吧。</p>
<p>源码地址：<a target="_blank" rel="noopener" href="https://wwe.lanzoui.com/iMWRImu1kad">蓝奏云素材</a></p>
<h1 id="Vue引入HTML"><a href="#Vue引入HTML" class="headerlink" title="Vue引入HTML"></a>Vue引入HTML</h1><h2 id="html使用vue组件"><a href="#html使用vue组件" class="headerlink" title="html使用vue组件"></a>html使用vue组件</h2><h4 id="1-不传递数据"><a href="#1-不传递数据" class="headerlink" title="1.不传递数据"></a>1.不传递数据</h4><h2 id="navigation-bar-html"><a href="#navigation-bar-html" class="headerlink" title="navigation_bar.html"></a>navigation_bar.html</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;!-- 引入样式 --&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;../element-ui/lib/theme-chalk/index.css&quot;&gt;</span><br><span class="line">    &lt;!-- 引入组件库 --&gt;</span><br><span class="line">    &lt;script src=&quot;../element-ui/lib/index.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;../components/navigation_bar.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;title&gt;navigation-bar&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;navigation-bar&gt;&lt;/navigation-bar&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">        el: &#x27;#app&#x27;,</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="navigation-bar-js-第一种方式"><a href="#navigation-bar-js-第一种方式" class="headerlink" title="navigation_bar.js (第一种方式)"></a>navigation_bar.js (第一种方式)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&#x27;navigation-bar&#x27;, &#123;</span><br><span class="line">    template:</span><br><span class="line">        `&lt;el-menu default-active=&quot;1&quot; class=&quot;el-menu-demo&quot; mode=&quot;horizontal&quot; @select=&quot;handleSelect&quot;&gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;1&quot;&gt;处理中心&lt;/el-menu-item&gt;</span><br><span class="line">                &lt;el-submenu index=&quot;2&quot;&gt;</span><br><span class="line">                    &lt;template slot=&quot;title&quot;&gt;我的工作台&lt;/template&gt;</span><br><span class="line">                    &lt;el-menu-item index=&quot;2-1&quot;&gt;选项1&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;el-menu-item index=&quot;2-2&quot;&gt;选项2&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;el-menu-item index=&quot;2-3&quot;&gt;选项3&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;el-submenu index=&quot;2-4&quot;&gt;</span><br><span class="line">                        &lt;template slot=&quot;title&quot;&gt;选项4&lt;/template&gt;</span><br><span class="line">                        &lt;el-menu-item index=&quot;2-4-1&quot;&gt;选项1&lt;/el-menu-item&gt;</span><br><span class="line">                        &lt;el-menu-item index=&quot;2-4-2&quot;&gt;选项2&lt;/el-menu-item&gt;</span><br><span class="line">                        &lt;el-menu-item index=&quot;2-4-3&quot;&gt;选项3&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;/el-submenu&gt;</span><br><span class="line">                &lt;/el-submenu&gt;</span><br><span class="line">            &lt;/el-menu&gt;`,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleSelect(key, keyPath) &#123;</span><br><span class="line">            console.log(key, keyPath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>不需要父传给子组件值的参数<code>直接写死</code>(default-active),且参数前不用加:</p>
</blockquote>
<h2 id="navigation-bar-js-第二种方式"><a href="#navigation-bar-js-第二种方式" class="headerlink" title="navigation_bar.js (第二种方式)"></a>navigation_bar.js (第二种方式)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&#x27;navigation-bar&#x27;, &#123;</span><br><span class="line">    template:</span><br><span class="line">        `&lt;el-menu :default-active=&quot;defaultIndex&quot; class=&quot;el-menu-demo&quot; mode=&quot;horizontal&quot; @select=&quot;handleSelect&quot;&gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;1&quot;&gt;处理中心&lt;/el-menu-item&gt;</span><br><span class="line">                &lt;el-submenu index=&quot;2&quot;&gt;</span><br><span class="line">                    &lt;template slot=&quot;title&quot;&gt;我的工作台&lt;/template&gt;</span><br><span class="line">                    &lt;el-menu-item index=&quot;2-1&quot;&gt;选项1&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;el-menu-item index=&quot;2-2&quot;&gt;选项2&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;el-menu-item index=&quot;2-3&quot;&gt;选项3&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;el-submenu index=&quot;2-4&quot;&gt;</span><br><span class="line">                        &lt;template slot=&quot;title&quot;&gt;选项4&lt;/template&gt;</span><br><span class="line">                        &lt;el-menu-item index=&quot;2-4-1&quot;&gt;选项1&lt;/el-menu-item&gt;</span><br><span class="line">                        &lt;el-menu-item index=&quot;2-4-2&quot;&gt;选项2&lt;/el-menu-item&gt;</span><br><span class="line">                        &lt;el-menu-item index=&quot;2-4-3&quot;&gt;选项3&lt;/el-menu-item&gt;</span><br><span class="line">                    &lt;/el-submenu&gt;</span><br><span class="line">                &lt;/el-submenu&gt;</span><br><span class="line">            &lt;/el-menu&gt;`,</span><br><span class="line">    data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">            defaultIndex:&#x27;2&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleSelect(key, keyPath) &#123;</span><br><span class="line">            console.log(key, keyPath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>不需要父传给子组件值的参数<code>通过data赋值</code>(:default-active=“defaultIndex”)</p>
</blockquote>
<h4 id="2-父给子组件赋值"><a href="#2-父给子组件赋值" class="headerlink" title="2.父给子组件赋值"></a>2.父给子组件赋值</h4><h2 id="my-table-html"><a href="#my-table-html" class="headerlink" title="my_table.html"></a>my_table.html</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;!-- 引入样式 --&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;../element-ui/lib/theme-chalk/index.css&quot;&gt;</span><br><span class="line">    &lt;!-- 引入组件库 --&gt;</span><br><span class="line">    &lt;script src=&quot;../element-ui/lib/index.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;../components/my_table.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;title&gt;my_table&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;my_table :table-data=&quot;tData&quot; :msg=&quot;message&quot; :ht=&quot;height&quot;&gt;&lt;/my_table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">        el: &#x27;#app&#x27;,</span><br><span class="line">        data()&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                tData: [&#123;</span><br><span class="line">                    date: &#x27;2016-05-02&#x27;,</span><br><span class="line">                    name: &#x27;王小虎&#x27;,</span><br><span class="line">                    address: &#x27;上海市普陀区金沙江路 1518 弄&#x27;</span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    date: &#x27;2016-05-04&#x27;,</span><br><span class="line">                    name: &#x27;王小虎&#x27;,</span><br><span class="line">                    address: &#x27;上海市普陀区金沙江路 1517 弄&#x27;</span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    date: &#x27;2016-05-01&#x27;,</span><br><span class="line">                    name: &#x27;王小虎&#x27;,</span><br><span class="line">                    address: &#x27;上海市普陀区金沙江路 1519 弄&#x27;</span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    date: &#x27;2016-05-03&#x27;,</span><br><span class="line">                    name: &#x27;王小虎&#x27;,</span><br><span class="line">                    address: &#x27;上海市普陀区金沙江路 1516 弄&#x27;</span><br><span class="line">                &#125;],</span><br><span class="line">                message:&quot;msgmsgmsgmsgmsg&quot;,</span><br><span class="line">                height:800,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="my-table-js"><a href="#my-table-js" class="headerlink" title="my_table.js"></a>my_table.js</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&#x27;my_table&#x27;, &#123;</span><br><span class="line">    template:</span><br><span class="line">        `&lt;div&gt;</span><br><span class="line">              &lt;el-table</span><br><span class="line">              :height=&quot;ht&quot;</span><br><span class="line">              :data=&quot;tableData&quot;</span><br><span class="line">              style=&quot;width: 100%&quot;&gt;</span><br><span class="line">              &lt;el-table-column</span><br><span class="line">                prop=&quot;date&quot;</span><br><span class="line">                label=&quot;日期&quot;</span><br><span class="line">                width=&quot;180&quot;&gt;</span><br><span class="line">              &lt;/el-table-column&gt;</span><br><span class="line">              &lt;el-table-column</span><br><span class="line">                prop=&quot;name&quot;</span><br><span class="line">                label=&quot;姓名&quot;</span><br><span class="line">                width=&quot;180&quot;&gt;</span><br><span class="line">              &lt;/el-table-column&gt;</span><br><span class="line">              &lt;el-table-column</span><br><span class="line">                prop=&quot;address&quot;</span><br><span class="line">                label=&quot;地址&quot;&gt;</span><br><span class="line">              &lt;/el-table-column&gt;</span><br><span class="line">            &lt;/el-table&gt;</span><br><span class="line">            &lt;hr&gt;</span><br><span class="line">            &#123;&#123;msg&#125;&#125;</span><br><span class="line">          &lt;/div&gt;`,</span><br><span class="line">    props: [&#x27;tableData&#x27;,&#x27;msg&#x27;,&#x27;ht&#x27;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>1.需要父传给子组件的参数,需要使用props参数,添加改参数;</p>
<p>且需要在使用处引用该参数(:data=“tableData”,:height=“ht”)</p>
<p>2.父引用子组件时,需要将传递的参数在标签中赋值:</p>
<p>如果是自定义的属性,则直接用:加上props中的名称赋值即可(:msg=“message”,:ht=“height”)</p>
<p>如果是特定的属性,则不是使用自定义的赋值方法(用:table-data=“tData”,而不是:tableData=“tData”)</p>
<p>原因是使用驼峰式命名会自动转化为table-data</p>
</blockquote>
<h4 id="3-父传给子-子改变后再传给父"><a href="#3-父传给子-子改变后再传给父" class="headerlink" title="3.父传给子,子改变后再传给父"></a>3.父传给子,子改变后再传给父</h4><h3 id="my-select-html"><a href="#my-select-html" class="headerlink" title="my_select.html"></a>my_select.html</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;!-- 引入样式 --&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;../element-ui/lib/theme-chalk/index.css&quot;&gt;</span><br><span class="line">    &lt;!-- 引入组件库 --&gt;</span><br><span class="line">    &lt;script src=&quot;../element-ui/lib/index.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;../components/my_select.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;title&gt;my_select&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;my_select :options=&quot;options&quot; @on_submit_father_prop=&quot;onSubmitFather&quot; @on_change_father_prop=&quot;onSubmitFather&quot;&gt;&lt;/my_select&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    父组件value:&#123;&#123;value&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    new Vue(&#123;</span><br><span class="line">        el: &#x27;#app&#x27;,</span><br><span class="line">        data()&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                options: [ &#x27;黄金糕&#x27;, &#x27;双皮奶&#x27;,&#x27;蚵仔煎&#x27;,&#x27;龙须面&#x27;],</span><br><span class="line">                value:&quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            onSubmitFather(a)&#123;</span><br><span class="line">                this.value = a</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="my-select-js"><a href="#my-select-js" class="headerlink" title="my_select.js"></a>my_select.js</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(&#x27;my_select&#x27;, &#123;</span><br><span class="line">    template:</span><br><span class="line">        `&lt;div&gt;</span><br><span class="line">            &lt;el-form :inline=&quot;true&quot;  class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">              &lt;el-form-item label=&quot;活动区域&quot;&gt;</span><br><span class="line">                &lt;el-select v-model=&quot;value&quot; placeholder=&quot;请选择&quot; @change=&quot;onChange&quot;&gt;</span><br><span class="line">                    &lt;el-option</span><br><span class="line">                      v-for=&quot;item in options&quot;</span><br><span class="line">                      :key=&quot;item&quot;</span><br><span class="line">                      :label=&quot;item&quot;</span><br><span class="line">                      :value=&quot;item&quot;&gt;</span><br><span class="line">                    &lt;/el-option&gt;</span><br><span class="line">                  &lt;/el-select&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">              &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;onSubmit&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">              &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">            &lt;hr&gt;</span><br><span class="line">            子组件value:&#123;&#123;value&#125;&#125;</span><br><span class="line">        &lt;/div&gt;`,</span><br><span class="line">    data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">            value:&#x27;&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    props:[&#x27;options&#x27;],</span><br><span class="line">    methods: &#123;</span><br><span class="line">        onSubmit()&#123;</span><br><span class="line">            this.$emit(&#x27;on_submit_father_prop&#x27;, this.value)</span><br><span class="line">        &#125;,</span><br><span class="line">        onChange()&#123;</span><br><span class="line">            this.$emit(&#x27;on_change_father_prop&#x27;, this.value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意观察<code>on_submit_father_prop</code>,<code>onSubmit</code>,<code>onSubmitFather</code>:</p>
<p>作为标签属性的<code>on_submit_father_prop</code>不要使用驼峰式命名,不然会自动转化为<code>on-submit-father-prop</code></p>
</blockquote>
<h2 id="全局事件总线"><a href="#全局事件总线" class="headerlink" title="全局事件总线"></a>全局事件总线</h2><h1 id="一、理解"><a href="#一、理解" class="headerlink" title="一、理解"></a>一、理解</h1><h2 id="1-1、-Vue-原型对象上包含事件处理的方法"><a href="#1-1、-Vue-原型对象上包含事件处理的方法" class="headerlink" title="1.1、 Vue 原型对象上包含事件处理的方法"></a>1.1、 Vue 原型对象上包含事件处理的方法</h2><ol>
<li>$on(eventName, listener): 绑定自定义事件监听</li>
<li>$emit(eventName, data): 分发自定义事件</li>
<li>$off(eventName): 解绑自定义事件监听</li>
<li>$once(eventName, listener): 绑定事件监听, 但只能处理一次</li>
</ol>
<h2 id="1-2、所有组件实例对象的原型对象的原型对象就是-Vue-的原型对象"><a href="#1-2、所有组件实例对象的原型对象的原型对象就是-Vue-的原型对象" class="headerlink" title="1.2、所有组件实例对象的原型对象的原型对象就是 Vue 的原型对象"></a>1.2、所有组件实例对象的原型对象的原型对象就是 Vue 的原型对象</h2><p>所有组件对象都能看到 Vue 原型对象上的属性和方法<br>Vue.prototype.b u s = n e w V u e ( ) , 所 有 的 组 件 对 象 都 能 看 到 bus = new Vue(), 所有的组件对象都能看到bus=newVue(),所有的组件对象都能看到bus 这个属性<br>对象</p>
<h2 id="1-3、全局事件总线"><a href="#1-3、全局事件总线" class="headerlink" title="1.3、全局事件总线"></a>1.3、全局事件总线</h2><ol>
<li>包含事件处理相关方法的对象(只有一个)</li>
<li>所有的组件都可以得到</li>
</ol>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="2-1、指定事件总线对象"><a href="#2-1、指定事件总线对象" class="headerlink" title="2.1、指定事件总线对象"></a>2.1、指定事件总线对象</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">beforeCreate () &#123; <span class="comment">// 尽量早的执行挂载全局事件总线对象的操作</span></span><br><span class="line">Vue.prototype.$globalEventBus = <span class="built_in">this</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#root&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-3、分发事件"><a href="#2-3、分发事件" class="headerlink" title="2.3、分发事件"></a>2.3、分发事件</h2><p>其中<code>this.data</code>表示要传递的数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$globalEventBus.$emit(<span class="string">&#x27;deleteTodo&#x27;</span>, <span class="built_in">this</span>.data)</span><br></pre></td></tr></table></figure>

<h2 id="2-2、绑定事件"><a href="#2-2、绑定事件" class="headerlink" title="2.2、绑定事件"></a>2.2、绑定事件</h2><p>其中<code>this.deleteTodo</code>表示一个回调函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$globalEventBus.$on(<span class="string">&#x27;deleteTodo&#x27;</span>, <span class="built_in">this</span>.deleteTodo)</span><br></pre></td></tr></table></figure>

<h2 id="2-4、解绑事件"><a href="#2-4、解绑事件" class="headerlink" title="2.4、解绑事件"></a>2.4、解绑事件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$globalEventBus.$off(<span class="string">&#x27;deleteTodo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p>假设兄弟组件有三个，分别是A、B、C组件，C组件如何获取A或者B组件的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;itany&quot;&gt;</span><br><span class="line">    &lt;my-a&gt;&lt;/my-a&gt;</span><br><span class="line">    &lt;my-b&gt;&lt;/my-b&gt;</span><br><span class="line">    &lt;my-c&gt;&lt;/my-c&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;template id=&quot;a&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3&gt;A组件：&#123;&#123;name&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;send&quot;&gt;将数据发送给C组件&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;template id=&quot;b&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3&gt;B组件：&#123;&#123;age&#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;button @click=&quot;send&quot;&gt;将数组发送给C组件&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;template id=&quot;c&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3&gt;C组件：&#123;&#123;name&#125;&#125;，&#123;&#123;age&#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var Event = new Vue();//定义一个空的Vue实例</span><br><span class="line">var A = &#123;</span><br><span class="line">    template: &#x27;#a&#x27;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        name: &#x27;tom&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      send() &#123;</span><br><span class="line">        Event.$emit(&#x27;data-a&#x27;, this.name);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var B = &#123;</span><br><span class="line">    template: &#x27;#b&#x27;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        age: 20</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      send() &#123;</span><br><span class="line">        Event.$emit(&#x27;data-b&#x27;, this.age);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var C = &#123;</span><br><span class="line">    template: &#x27;#c&#x27;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        name: &#x27;&#x27;,</span><br><span class="line">        age: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;//在模板编译完成后执行</span><br><span class="line">     Event.$on(&#x27;data-a&#x27;,name =&gt; &#123;</span><br><span class="line">         this.name = name;//箭头函数内部不会产生新的this，这边如果不用=&gt;,this指代Event</span><br><span class="line">     &#125;)</span><br><span class="line">     Event.$on(&#x27;data-b&#x27;,age =&gt; &#123;</span><br><span class="line">         this.age = age;</span><br><span class="line">     &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">    el: &#x27;#itany&#x27;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      &#x27;my-a&#x27;: A,</span><br><span class="line">      &#x27;my-b&#x27;: B,</span><br><span class="line">      &#x27;my-c&#x27;: C</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);    </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="vue的promise和async和await使用"><a href="#vue的promise和async和await使用" class="headerlink" title="vue的promise和async和await使用"></a>vue的promise和async和await使用</h2><p>最开始实现异步的方法：回调函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">method1(function(err, result) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        throw err;</span><br><span class="line">    &#125;</span><br><span class="line">    method2(function(err, result) &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            throw err;</span><br><span class="line">        &#125;</span><br><span class="line">        method3(function(err, result) &#123;</span><br><span class="line">            if (err) &#123;</span><br><span class="line">                throw err;</span><br><span class="line">            &#125;</span><br><span class="line">            method4(function(err, result) &#123;</span><br><span class="line">                if (err) &#123;</span><br><span class="line">                    throw err;</span><br><span class="line">                &#125;</span><br><span class="line">                method5(result);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>回调地狱一层一层嵌套多个回调函数，会使代码错综复杂，难以理解和调试。</p>
<p>promise</p>
<p>promise是异步编程的一种解决方案，比传统的解决方案–回调函数和事件，更合理更强大。所谓promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，promise是一个对象，可以获取异步操作的消息，提供统一的API，各种异步操作都可以用同样的方法进行处理。</p>
<p>特点：1、对象状态不受外界影响。Promise 对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和 rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。</p>
<p>2、一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从pending变为fulfiled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。如果改变已经发生了，你再对promise对象添加回调函数，也会立即得到这个结果。这与事件完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。</p>
<p>有了promise对象，就可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。此外，promise对象提供统一的借口，使得控制异步操作更加容易。</p>
<p>基本用法：</p>
<p>promise对象是一个构造函数，用来生成promise实例。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const promise = new Promise(function(resolve, reject) &#123;</span><br><span class="line">  // ... some code</span><br><span class="line"></span><br><span class="line">  if (/* 异步操作成功 */)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>resolve和reject是两个函数，由javascript引擎提供，不用自己部署。</p>
<p>resolve函数作用：将promise对象的状态从未完成变为成功（即从pending变为resolved）,在异步操作成功时调用，并将异步操作的结果，作为参数传递出去。</p>
<p>reject函数作用：将promise对象的状态从未完成变为失败（即从pending变为rejected）,在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。</p>
<p>Promise实例生成后用then方法分别指定resolved状态和rejected状态的回调函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">promise.then(function(value)&#123;</span><br><span class="line">  // success</span><br><span class="line">&#125;, function(error)&#123;</span><br><span class="line">  // failure</span><br><span class="line">&#125;)</span><br><span class="line">// then方法的第二个参数可选，不一定要提供，</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function timeout(ms)&#123;</span><br><span class="line"> return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    setTimeout(resolve(&#x27;done&#x27;), ms);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeout(100).then(function(value)&#123;</span><br><span class="line">   console.log(value);</span><br><span class="line">&#125;, function(error)&#123;</span><br><span class="line">   throw error;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p> 如果调用resolve函数和reject函数时带有参数，那么它们的参数会被传递给回调函数。reject函数的参数通常是Error对象的实例，表示抛出的错误；resolve函数的参数除了正常的值外，还可能是另一个Promise实例。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const p1 = new Promise(function(resolve, reject)&#123;</span><br><span class="line">  setTimeout(() =&gt; reject(new Error(&#x27;fail&#x27;)), 3000);</span><br><span class="line">&#125;);</span><br><span class="line">const p2 = new Promise(function(resolve, reject)&#123;</span><br><span class="line">  setTimeout(() =&gt; resolve(p1), 1000);</span><br><span class="line">&#125;);</span><br><span class="line">p2.then(result =&gt; console.log(result)).catch(error =&gt; console.log(error));</span><br><span class="line">// Error: fail</span><br></pre></td></tr></table></figure>

<p>p1 是一个 Promise，3 秒之后变为 rejected。p2 的状态在 1 秒之后改变，resolve 方法返回的是 p1。由于 p2 返回的是另一个 Promise，导致 p2 自己的状态无效了，由 p1 的状态决定 p2 的状态。所以，后面的 then 语句都变成针对后者 p1。又过了 2 秒，p1 变为rejected，导致触发 catch 方法指定的回调函数。</p>
<p>注：调用resolve或reject并不会终结promise的参数函数的执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">   resolve(1);</span><br><span class="line">   console.log(2);</span><br><span class="line">&#125;).then(r =&gt; &#123;</span><br><span class="line">   console.log(r);</span><br><span class="line">&#125;)</span><br><span class="line">// 2</span><br><span class="line">// 1</span><br></pre></td></tr></table></figure>

<p>调用resolve(1)以后，后面的console.log(2)继续执行，并且会先打印出来，因为立即resolved的promise是在本轮事件循环的末尾执行，总是晚于本轮循环的同步任务。一般来说，调用resolve或reject以后，promise的使命就完成了，后续操作应该放到then方法里面，而不应该直接写在resolve或reject后面，所以最好在它们前面加上return语句，这样就不会有意外。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">  return resolve(1);</span><br><span class="line">  // 后面的语句不会执行</span><br><span class="line">  console.log(2);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>finally()</p>
<p>finally方法用于指定不管promise对象最后状态如何，都会执行的操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line"> .then(result =&gt; &#123;...&#125;)</span><br><span class="line"> .catch(error =&gt; &#123;...&#125;)</span><br><span class="line"> .finally(() =&gt; &#123;...&#125;);</span><br></pre></td></tr></table></figure>

<p>响应多个promise</p>
<p>Promise.all()方法，接收单个可迭代对象（如数组）作为参数，并返回一个promise。这个可迭代对象的元素都是promise，只有在它们都完成后，所返回的promsie才会被完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let p1 = new Promise(function(resolve, reject) &#123;</span><br><span class="line">    resolve(42);</span><br><span class="line">&#125;);</span><br><span class="line">let p2 = new Promise(function(resolve, reject) &#123;</span><br><span class="line">    resolve(43);</span><br><span class="line">&#125;);</span><br><span class="line">let p3 = new Promise(function(resolve, reject) &#123;</span><br><span class="line">    resolve(44);</span><br><span class="line">&#125;);</span><br><span class="line">let p4 = Promise.all([p1, p2, p3]);</span><br><span class="line">p4.then(function(value) &#123;</span><br><span class="line">    console.log(Array.isArray(value));  // true</span><br><span class="line">    console.log(value[0]);              //  42</span><br><span class="line">    console.log(value[1]);              //  43</span><br><span class="line">    console.log(value[2]);              //  44</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Promise.race()方法：接收一个可迭代对象作为参数，并返回一个新的promise，一旦来源promise中有一个被解决，所返回的promise就会立刻被解决。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let p1 = Promise.resolve(42); //等价于p1=new Promise(resolve =&gt; resolve(42));</span><br><span class="line">let p2 = new Promise(function(resolve, reject) &#123;</span><br><span class="line">    resolve(43);</span><br><span class="line">&#125;);</span><br><span class="line">let p3 = new Promise(function(resolve, reject) &#123;</span><br><span class="line">    resolve(44);</span><br><span class="line">&#125;);</span><br><span class="line">let p4 = Promise.race([p1, p2, p3]);</span><br><span class="line">p4.then(function(value) &#123;</span><br><span class="line">    console.log(value);     // 42</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Promise缺点</p>
<p>1、无法取消Promise,一旦新建它就会立即执行，无法中途取消。</p>
<p>2、如果不设置回调函数，promise内部抛出的错误，不会反应到外部。</p>
<p>3、当处于pending状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）。</p>
<p>async</p>
<p>async表示函数里有异步操作，await表示紧跟在后面的表达式需要等待结果。</p>
<p>async函数返回一个Promise对象，async函数内部return语句返回的值，会成为then方法回调函数的参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">async function f()&#123;</span><br><span class="line">  return &#x27;hello world&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">f().then(v =&gt; console.log(v));</span><br><span class="line">// &quot;hello world&quot;</span><br></pre></td></tr></table></figure>

<p>async函数内部抛出的错误，会导致返回的promise对象变为reject状态。抛出的错误对象会被catch方法回调函数接收到。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">async function f()&#123;</span><br><span class="line">  throw new Error(&#x27;出错了&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">f().catch(e =&gt; console.log(e))</span><br><span class="line">// Error:出错了</span><br></pre></td></tr></table></figure>

<p>async 函数返回的 Promise 对象，必须等到内部所有 await 命令后面的 Promise 对象执行完，才会发生状态改变，除非遇到 return 语句或者抛出错误。也就是说，只有async函数内部的异步操作执行完，才会执行then方法指定的回调函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">async function asyncTest() &#123;</span><br><span class="line">    let getUrl = await fetch();</span><br><span class="line">    console.log(getUrl);</span><br><span class="line">    let downloadUrl = await download();</span><br><span class="line">    console.log(downloadUrl);</span><br><span class="line">    return &#x27;complete&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">asyncTest().then(console.log)</span><br><span class="line"></span><br><span class="line">function fetch() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">            resolve(&#x27;fetchDone&#x27;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function download() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">            resolve(&#x27;downloadDone&#x27;);</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码模拟了一个抓取和一个下载，只有这两个操作全部完成，才会执行then方法里面的console.log</p>
<p>await</p>
<p>正常情况下，await命令后面是一个Promise对象，如果不是，会被转成一个立即resolve的Promise对象。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">async function f()&#123;</span><br><span class="line">   return await 123;     //await命令后面的参数是数值123，它被转成Promise对象，并立</span><br><span class="line">                                // 即resolve</span><br><span class="line">&#125;</span><br><span class="line">f().then(v =&gt; console.log(v))</span><br><span class="line">//123</span><br></pre></td></tr></table></figure>

<p>await命令后面的promise对象如果变成reject状态，则reject的参数会被catch方法的回调函数接收到。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">async function f()&#123;</span><br><span class="line">   await Promise.reject(&#x27;出错了&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">f().then(v =&gt; console.log(v)).catch(e =&gt; console.log(e))</span><br><span class="line">//出错了</span><br></pre></td></tr></table></figure>

<p>注意上面代码中await语句前面没有return,但是reject方法的参数依然传入了catch方法的回调函数。如果在await前面加上return,效果一样。</p>
<p>只要一个await语句后面的Promise变为reject，那么整个async函数都会中断执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">async function f()&#123;</span><br><span class="line">   await Promise.reject(&#x27;出错了&#x27;);</span><br><span class="line">   await Promise.resolve(&#x27;hello world&#x27;);   //不会执行</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们希望即使前一个异步操作失败，也不要中断后面的异步操作。这时可以将第一个await放try…catch结构里面，这样不管这个异步操作是否成功，第二个await都会执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">async function f()&#123;</span><br><span class="line">  try &#123;</span><br><span class="line">     await Promise.reject(&#x27;出错了&#x27;)；</span><br><span class="line">  &#125; catch(e)&#123;&#125;</span><br><span class="line"></span><br><span class="line">  return await Promise.resolve(&#x27;hello world&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">f().then(v =&gt; console.log(v));</span><br><span class="line">// hello world</span><br></pre></td></tr></table></figure>

<p>另一种方法是await后面的Promise对象再跟一个catch方法，处理前面可能出现的错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">async function f()&#123;</span><br><span class="line">  await Promise.reject(&quot;出错了&quot;)</span><br><span class="line">           .catch(e =&gt; console.log(e));</span><br><span class="line">   return await Promise.resolve(&#x27;hello world&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">f().then(v =&gt; console.log(v))</span><br><span class="line">//出错了</span><br><span class="line">// hello world</span><br></pre></td></tr></table></figure>

<p>await命令后面的Promise对象，运行结果可能是rejected, 所以最好把await命令放在try…catch代码块中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">async function myFunction() &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    await somethingThatReturnsAPromise();</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 另一种写法</span><br><span class="line"></span><br><span class="line">async function myFunction() &#123;</span><br><span class="line">  await somethingThatReturnsAPromise()</span><br><span class="line">  .catch(function (err) &#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多个await命令后面的异步操作，如果不存在继发关系，最好让它们同时触发。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 写法一</span><br><span class="line">async function test() &#123;</span><br><span class="line">    let [foo, bar] = await Promise.all([getFoo(), getBar()]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getFoo() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">            console.log(&#x27;getFoo&#x27;);</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getBar() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">            console.log(&#x27;getBar&#x27;);</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test()</span><br><span class="line"></span><br><span class="line">// 写法二</span><br><span class="line">async function test() &#123;</span><br><span class="line">    let fooPromise = getFoo();</span><br><span class="line">    let barPromise = getBar();</span><br><span class="line">    let foo = await fooPromise;</span><br><span class="line">    let bar = await barPromise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>await命令只能用在async函数中，如果用在普通函数，就会报错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">async function test() &#123;</span><br><span class="line">    let promises = [function1, function2, function3]</span><br><span class="line"></span><br><span class="line">    promises.forEach(function (fun) &#123;</span><br><span class="line">        const t = await fun();</span><br><span class="line">        console.log(t)</span><br><span class="line">    &#125;);</span><br><span class="line">   //Uncaught SyntaxError: await is only valid in async function</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function function1() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">            resolve(&#x27;function1&#x27;)</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function function2() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">            resolve(&#x27;function2&#x27;)</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function function3() &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">            resolve(&#x27;function3&#x27;)</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<p>如果将forEach方法的参数改成async函数，也有问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promises.forEach(async function (fun) &#123;</span><br><span class="line">    const t = await fun();</span><br><span class="line">    console.log(t)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上面代码可能不会正常工作，原因是这时三个异步操作将是并发执行，也就是同时执行，而不是继发执行。正确的写法是采用 for 循环。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for (let i of promises) &#123;</span><br><span class="line">    const t = await i()</span><br><span class="line">    console.log(t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果希望多个请求并发执行，可以使用Promise.all方法，当三个请求都resolved时，下面两种写法效果相同。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">async function test() &#123;</span><br><span class="line">    let promises = [function1(), function2(), function3()]</span><br><span class="line">    let results = await Promise.all(promises);</span><br><span class="line">    console.log(results)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title="0" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                        
                            <li title="1" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link"
		data-enable="false"
        data-ae="false"
        data-ci=""
        data-cs=""
        data-r=""
        data-o=""
        data-a=""
        data-d="false"
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
